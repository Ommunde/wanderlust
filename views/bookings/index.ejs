<% layout("layouts/boilerplate") %>

<div class="container mt-5">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4"><i class="fa-solid fa-calendar-check me-2"></i>My Bookings</h2>
      
      <% if (bookings.length === 0) { %>
        <div class="alert alert-info">
          <i class="fa-solid fa-info-circle me-2"></i>You don't have any bookings yet. 
          <a href="/listings" class="alert-link">Browse listings</a> to make a booking!
        </div>
      <% } else { %>
        <div class="row">
          <% bookings.forEach((booking) => { %>
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card shadow-sm border-0 rounded-4 h-100">
                <img src="<%= booking.listing.image.url %>" class="card-img-top" alt="<%= booking.listing.title %>" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                  <h5 class="card-title"><%= booking.listing.title %></h5>
                  <p class="text-muted mb-2">
                    <i class="fa-solid fa-location-dot me-1"></i><%= booking.listing.location %>, <%= booking.listing.country %>
                  </p>
                  
                  <div class="mb-2">
                    <small class="text-muted">
                      <i class="fa-solid fa-calendar-days me-1"></i>
                      Check-in: <%= booking.checkIn.toLocaleDateString() %>
                    </small>
                  </div>
                  <div class="mb-2">
                    <small class="text-muted">
                      <i class="fa-solid fa-calendar-days me-1"></i>
                      Check-out: <%= booking.checkOut.toLocaleDateString() %>
                    </small>
                  </div>
                  <div class="mb-2">
                    <small class="text-muted">
                      <i class="fa-solid fa-users me-1"></i>
                      Guests: <%= booking.guests %>
                    </small>
                  </div>
                  
                  <div class="mb-3">
                    <strong class="text-success">
                      <i class="fa-solid fa-indian-rupee-sign me-1"></i>
                      <%= booking.totalPrice.toLocaleString("en-IN") %>
                    </strong>
                  </div>
                  
                  <div class="mb-3">
                    <% if (booking.status === "confirmed") { %>
                      <span class="badge bg-success">Confirmed</span>
                    <% } else if (booking.status === "cancelled") { %>
                      <span class="badge bg-danger">Cancelled</span>
                    <% } else { %>
                      <span class="badge bg-warning">Pending</span>
                    <% } %>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <a href="/bookings/<%= booking._id %>" class="btn btn-outline-primary btn-sm flex-fill">
                      <i class="fa-solid fa-eye me-1"></i>View Details
                    </a>
                    <% if (booking.status === "confirmed") { %>
                      <form method="POST" action="/bookings/<%= booking._id %>?_method=DELETE" class="flex-fill">
                        <button type="submit" class="btn btn-outline-danger btn-sm w-100" onclick="return confirm('Are you sure you want to cancel this booking?')">
                          <i class="fa-solid fa-times me-1"></i>Cancel
                        </button>
                      </form>
                    <% } %>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</div>
